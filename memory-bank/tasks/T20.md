# T20: Implement Comprehensive Logging System
*Created: 2025-05-17 14:30*
*Last Updated: 2025-05-17 14:30*

## Overview
**Status**: â¬œ Not Started
**Priority**: HIGH
**Started**: -
**Dependencies**: None

## Description
Implement a local-first logging system to track arXiv queries, LLM usage, and system events. This system will help monitor API rate limits, track resource usage, and provide insights into system performance.

## Completion Criteria

### 1. Core Logging Infrastructure
- â¬œ Local file-based logging system
- â¬œ Log rotation and cleanup
- â¬œ Structured log format (JSON)
- â¬œ Log levels (INFO, WARN, ERROR)

### 2. arXiv Query Monitoring
- â¬œ Track all arXiv API calls
- â¬œ Monitor rate limits
- â¬œ Log query parameters
- â¬œ Response status tracking

### 3. LLM Usage Tracking
- â¬œ Monitor Gemini API calls
- â¬œ Track token usage
- â¬œ Log latency metrics
- â¬œ Cost estimation

### 4. System Event Logging
- â¬œ URL access patterns
- â¬œ Error tracking
- â¬œ Performance metrics
- â¬œ User actions (anonymous)

### 5. Visualization & Analysis
- â¬œ Basic log viewer
- â¬œ Usage statistics
- â¬œ Rate limit warnings
- â¬œ Error summaries

## Implementation Plan

### Phase 1: Core Infrastructure
1. Create FileLogger class
   - Initialize log directory
   - Implement log levels
   - Setup JSON formatting
   - Add basic rotation

2. Setup Directory Structure
   - Create logging directory
   - Define file naming convention
   - Implement cleanup routines

3. Define Core Interfaces
   - Logger interface
   - Log entry types
   - Configuration options

### Phase 2: API Integration
1. arXiv API Logging
   - Track all queries
   - Monitor rate limits
   - Log response status
   - Track errors

2. LLM API Logging
   - Monitor Gemini calls
   - Track token usage
   - Measure latency
   - Log costs

### Phase 3: System Events
1. URL Tracking
   - Log accessed URLs
   - Track response times
   - Monitor errors

2. Performance Metrics
   - System resource usage
   - Operation latency
   - Error rates

### Phase 4: Analysis Tools
1. Log Viewer
   - Basic UI
   - Filtering
   - Search

2. Statistics Generation
   - Usage reports
   - Error summaries
   - Rate limit status

## Files
- `src/lib/logging/`
  - `logger.ts` - Main logger class
  - `rotation.ts` - Log rotation
  - `formatters.ts` - Log formatting
  - `types.ts` - Type definitions
- `src/lib/logging/integrations/`
  - `arxiv.ts` - arXiv logging
  - `llm.ts` - LLM logging
- `src/components/admin/`
  - `LogViewer.tsx` - Log visualization
  - `Stats.tsx` - Usage statistics

## Technical Notes
- Use local storage first for privacy
- Implement log rotation to manage storage
- Focus on minimal performance impact
- Ensure thread-safe logging
- Use structured logging format
- Support different log levels
- Include timestamp and context with each log
- Implement proper error handling
- Add log compression for storage efficiency
- Support log filtering and search

## Progress
1. âœ… Phase 1: Core Infrastructure
   - âœ… Created basic logger structure
   - âœ… Implemented Supabase logger
   - âœ… Created system_logs table with proper schema
   - âœ… Implemented log cleanup policy
   - âœ… Added comprehensive logging to ArXiv API
   - âœ… Added comprehensive logging to LLM API

2. ðŸ”„ Phase 2: API Integration
   - âœ… ArXiv API logging with:
     - Query parameters and URLs
     - Response metadata
     - Timing information
     - Fallback scenarios
   - âœ… LLM API logging with:
     - Model details
     - Token counts
     - Response content
     - Cache hits
     - Error scenarios

3. â¬œ Phase 3: System Events
4. â¬œ Phase 4: Analysis Tools

## Technical Notes
- Supabase system_logs table implemented with:
  - Proper schema (timestamp, level, component, message, metadata)
  - RLS policies for security
  - Automatic cleanup policy for logs older than 30 days
- Enhanced ArXiv logging captures:
  - Query URLs and parameters
  - Total results (both metadata and actual)
  - Timing metrics
  - Fallback scenarios
- Enhanced LLM logging captures:
  - Full response content
  - Token usage details
  - Cache status
  - Error scenarios with context
2. â¬œ Phase 2: API Integration
3. â¬œ Phase 3: System Events
4. â¬œ Phase 4: Analysis Tools

## Related Issues
- GitHub Issue #14: "Log all arxiv queries"